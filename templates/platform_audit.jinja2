{# ----------------------------
  Platform Audit Template
  For CTO Board Briefing
  ---------------------------- #}

{# ---- Helper Macro for Currency Formatting ---- #}
{% macro money(v) -%}
  {%- if v is number -%}Â£{{ "{:,.0f}".format(v) }}{%- elif v -%}{{ v }}{%- else -%}â€”{%- endif -%}
{%- endmacro %}

{# ---- Normalize Prompt for Guard Checks ---- #}
{% set _p = (prompt|default('', true))|lower %}

{% set has_provider = 'aws' in _p or 'azure' in _p or 'gcp' in _p %}
{% set has_workload = 'kubernetes' in _p or 'eks' in _p or 'aks' in _p or 'ec2' in _p or 'vm' in _p or 'rds' in _p or 'sql' in _p %}
{% set has_modern   = 'kubernetes' in _p or 'eks' in _p or 'aks' in _p or 'ci/cd' in _p or 'github actions' in _p or 'azure devops' in _p or 'gitlab' in _p %}

{# ---- Guard Clause ---- #}
{% if not (has_provider and has_workload and has_modern) %}
**Need one detail to proceed:** Please specify:
- Cloud provider(s)
- Workload type(s)
- Mention of Kubernetes, CI/CD, or modern platform tools
{% else %}

Respond with a **concise, high-impact platform audit** for a CTO board briefing.  
Be quantified, decisive, and specific to the prompt â€” avoid generic best practices.

Prompt: {{ prompt }}
Tool concerned: Platform Audit

{% if context %}
Prior Conversation:
{{ context }}
{% endif %}

---

## ğŸš€ 90-Day ROI Summary
- **Cost Savings:** {{ cost_savings_note|default('Rightsize EKS/AKS node groups, optimise storage tiers, and reduce NAT costs') }} to save {{ money(cost_savings_amount)|default('â€”') }}{% if cost_savings_pct %} ({{ cost_savings_pct }}%){% endif %}.
- **Performance:** {{ performance_note|default('Reduce environment provisioning time by 30â€“50% via autoscaling tuning and pipeline parallelisation.') }}
- **Risk:** {{ risk_note|default('Close high-severity IAM/network findings by implementing short-lived credentials, least-privilege roles, and WAF rules.') }}

---

## ğŸ“ˆ Quick Wins (0â€“90 Days)
1. **EKS/AKS Node Optimisation** â€“ Convert underutilised On-Demand nodes to Spot for non-critical workloads.  
   *Owner:* Infra Team | *Effort:* M | *Impact:* {{ money(qw1_savings)|default('â€”') }}/year
2. **NAT Gateway/Data Transfer Reduction** â€“ Consolidate NAT usage per AZ and optimise routing.  
   *Owner:* SRE Team | *Effort:* S | *Impact:* {{ money(qw2_savings)|default('â€”') }}/year
3. **IAM Hygiene Automation** â€“ Implement automated key rotation and unused role removal.  
   *Owner:* Security Team | *Effort:* M | *Impact:* {{ qw3_impact|default('Reduce audit findings by 40%+') }}
4. **CI/CD Pipeline Efficiency** â€“ Parallelise builds/tests to cut deployment time by {{ qw4_pct|default('30%') }}.  
   *Owner:* DevOps Team | *Effort:* S | *Impact:* Faster releases
5. **Storage Lifecycle Policies** â€“ Apply tiering to S3/Blob storage and logs older than N days.  
   *Owner:* Infra Team | *Effort:* S | *Impact:* {{ money(qw5_savings)|default('â€”') }}/year

---

## ğŸ§  Strategic Notes
- {{ strategic1|default('Avoid overengineering with unnecessary multi-region or service mesh unless justified by SLAs/SLOs.') }}
- {{ strategic2|default('Standardise Kubernetes management between AWS and Azure to reduce cost and operational overhead.') }}
- {{ strategic3|default('Reduce security debt in parallel with cost optimisation.') }}

---

## â˜ï¸ Platform Review
**Cloud/Infra:**  
- Average compute utilisation: {{ compute_util|default('â€”') }} (Target: 60â€“70%)  
- NAT/data transfer costs: {{ money(nat_cost_month)|default('â€”') }}/month (Target: â‰¤{{ money(nat_cost_target)|default('â€”') }}/month)  
- Unused storage ratio: {{ unused_storage_pct|default('â€”') }}

**DevOps & Delivery:**  
- Avg pipeline runtime: {{ pipeline_runtime|default('â€”') }} (Target: â‰¤{{ pipeline_target|default('â€”') }})  
- Deployments automated: {{ deploy_auto_pct|default('â€”') }} (Target: 90%+)

**Kubernetes:**  
- Pod CPU request over-allocation: {{ pod_overalloc_pct|default('â€”') }}  
- Cluster autoscaler churn: {{ ca_events_week|default('â€”') }}/week (Target: â‰¤{{ ca_target_week|default('â€”') }}/week)

**Security:**  
- IAM roles with admin privileges: {{ admin_roles|default('â€”') }} (Target: â‰¤{{ admin_roles_target|default('â€”') }})  
- Long-lived IAM keys: {{ long_lived_keys|default('â€”') }} (Target: 0)

---

## ğŸ“Š KPI Scorecard
| Dimension         | Score/10 | Notable Gap Example                  |
|-------------------|----------|---------------------------------------|
| Cost Efficiency   | {{ kpi_cost|default('â€”') }} | {{ kpi_cost_gap|default('Over-provisioned compute & storage') }} |
| Security          | {{ kpi_sec|default('â€”') }}  | {{ kpi_sec_gap|default('Long-lived IAM keys') }} |
| Reliability       | {{ kpi_rel|default('â€”') }}  | {{ kpi_rel_gap|default('No DR test for key workloads') }} |
| Delivery Velocity | {{ kpi_dev|default('â€”') }}  | {{ kpi_dev_gap|default('Manual approvals in CI/CD pipeline') }} |

---

## ğŸ’¡ Next Steps
- âœ… Implement EKS/AKS Spot adoption plan  
- âœ… Consolidate NAT usage per AZ  
- âœ… Automate IAM key rotation and role review  
- âœ… Reduce K8s over-provisioning in requests/limits  
- âœ… Apply S3/Blob lifecycle policies

ğŸ“¬ For full implementation support and validation against real billing/performance data, contact **support@codeweave.co**.

{% endif %}
