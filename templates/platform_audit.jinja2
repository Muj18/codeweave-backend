{% set _p = (prompt|default('', true))|lower %}
{% set has_provider = 'aws' in _p or 'azure' in _p or 'gcp' in _p %}
{% set has_workload = 'kubernetes' in _p or 'eks' in _p or 'aks' in _p or 'ec2' in _p or 'vm' in _p or 'rds' in _p or 'sql' in _p %}
{% set has_modern = 'kubernetes' in _p or 'eks' in _p or 'aks' in _p or 'ci/cd' in _p or 'github actions' in _p or 'azure devops' in _p or 'gitlab' in _p %}

{% macro money(v) -%}{%- if v is number -%}Â£{{ "{:,.0f}".format(v) }}{%- elif v -%}{{ v }}{%- else -%}â€”{%- endif -%}{%- endmacro %}

{% if not (has_provider and has_workload and has_modern) %}
**Need one detail to proceed:** Please specify cloud provider(s), workload type(s), and mention Kubernetes, CI/CD, or a modern platform tool.
{% else %}

Respond with a **concise, high-impact platform audit** for a CTO board briefing.  
Be quantified, decisive, and specific to the prompt â€” avoid generic best practices.

Prompt: {{ prompt }}
Tool concerned: Platform Audit
{% if context %}

Prior Conversation:
{{ context }}
{% endif %}

## ğŸš€ 90-Day ROI Summary
- **Cost Savings:** {{ cost_savings_note|default('Rightsize EKS/AKS, storage tiering, and NAT consolidation') }} to save {{ money(cost_savings_amount)|default('â€”') }}{% if cost_savings_pct %} ({{ cost_savings_pct }}%){% endif %}.
- **Performance:** {{ performance_note|default('Cut provisioning time by 30â€“50% via autoscaling tuning and pipeline parallelisation.') }}
- **Risk:** {{ risk_note|default('Close high-severity IAM/network findings with short-lived creds, least-privilege roles, and WAF baselines.') }}

## ğŸ“ˆ Quick Wins (0â€“90 Days)
1) EKS/AKS Node Optimisation â€” Impact: {{ money(qw1_savings)|default('â€”') }}/yr  
2) NAT/Data Transfer Reduction â€” Impact: {{ money(qw2_savings)|default('â€”') }}/yr  
3) IAM Hygiene Automation â€” Impact: {{ qw3_impact|default('Reduce audit findings by 40%+') }}  
4) CI/CD Efficiency â€” Impact: {{ qw4_impact|default('Cut lead time by 30%') }}  
5) Storage Lifecycle Policies â€” Impact: {{ money(qw5_savings)|default('â€”') }}/yr

## ğŸ§  Strategic Notes
- {{ strategic1|default('Avoid overengineering unless tied to SLOs & revenue risk.') }}
- {{ strategic2|default('Standardise Kubernetes governance across clouds; reduce tool sprawl.') }}
- {{ strategic3|default('Pay down security debt in parallel with FinOps work.') }}

## â˜ï¸ Platform Review
**Cloud/Infra:** Utilisation {{ compute_util|default('â€”') }}, NAT {{ money(nat_cost_month)|default('â€”') }}/mo (Target â‰¤ {{ money(nat_cost_target)|default('â€”') }}/mo), Unused storage {{ unused_storage_pct|default('â€”') }}  
**DevOps:** Pipeline runtime {{ pipeline_runtime|default('â€”') }} (Target {{ pipeline_target|default('â€”') }}), Automation {{ deploy_auto_pct|default('â€”') }}  
**Kubernetes:** Pod over-allocation {{ pod_overalloc_pct|default('â€”') }}, Autoscaler churn {{ ca_events_week|default('â€”') }}/wk (Target â‰¤ {{ ca_target_week|default('â€”') }}/wk)  
**Security:** Admin roles {{ admin_roles|default('â€”') }} (Target â‰¤ {{ admin_roles_target|default('â€”') }}), Long-lived keys {{ long_lived_keys|default('â€”') }}

## ğŸ“Š KPI Scorecard
| Dimension | Score/10 | Gap |
|---|---:|---|
| Cost Efficiency | {{ kpi_cost|default('â€”') }} | {{ kpi_cost_gap|default('Over-provisioned compute & storage') }} |
| Security | {{ kpi_sec|default('â€”') }} | {{ kpi_sec_gap|default('Long-lived IAM keys') }} |
| Reliability | {{ kpi_rel|default('â€”') }} | {{ kpi_rel_gap|default('No DR test for key workloads') }} |
| Delivery Velocity | {{ kpi_dev|default('â€”') }} | {{ kpi_dev_gap|default('Manual approvals in CI/CD') }} |

## ğŸ’¡ Next Steps
- EKS/AKS Spot adoption  
- Consolidate NAT per AZ  
- Automate IAM key rotation & role review  
- Reduce K8s over-provisioning  
- Apply S3/Blob lifecycle policies

{% endif %}
