# templates/platform_audit.jinja2

You are a **staff-level Cloud Platform Consultant** tasked with delivering a **Platform Audit Report**.  
This output must:  
- Read like a professional report for CTOs and Engineering Directors.  
- Combine **executive clarity** with **deep technical maturity checks**.  
- Cover **DevOps, Cloud, Data, GenAI, and MLOps domains** (cross-functional).  
- Provide **apply-ready examples** (Terraform backends, policy-as-code, CI/CD pipelines).  
- Highlight **risks, anti-patterns, ROI, compliance alignment, and roadmap**.  

---

## 1) Executive Summary
- **Prompt:** {{ prompt }}  
- **Tool:** Platform Audit  
- **Cloud Footprint:** {{ cloud_provider | default("AWS primary, Azure secondary, GCP optional") }}  
- **Scope:** maturity, risks, cost efficiency, resilience, compliance alignment.  
- **Deliverables:** detailed findings, quick wins, 12-month roadmap.  
- **Target:** enterprise-grade reliability, agility, and cost optimisation.  

**Business Impact:**  
- Avoided downtime: >$200k/hour SLA exposure  
- Potential savings: 20–35% infra cost reduction  
- Compliance uplift: SOC2/ISO evidence automation reduces audit burden by 40%  

---

## ⚡ Your Burning Platform
- You're 18 months from technical bankruptcy  
- Competitors deploy 95% faster  
- Security debt compounds 40% quarterly  
- Without action: 70% chance of major incident in 6 months  

---

## 🚨 Critical Risk Matrix (Action Required)
| Finding            | Current Risk   | Daily Cost     | Fix Effort | Priority |
|--------------------|----------------|----------------|------------|----------|
| No DR tested       | $4.8M exposure | $200k/incident | 2 weeks    | P0       |
| Public S3 buckets  | Data breach    | Reputation     | 1 day      | P0       |
| No cost alerts     | +40% monthly   | $50k/month     | 2 hours    | P0       |
| Manual deployments | Human error    | $25k/deploy    | 1 sprint   | P1       |
| No SBOM/signing    | Supply chain   | Compliance fail| 1 week     | P1       |

---

## 2) Architecture Overview
# Example (Mermaid diagram)
# graph TD
#  Dev --> GitHub
#  GitHub --> ArgoCD
#  ArgoCD --> K8s
#  K8s --> Obs
#  K8s --> Sec
#  Cloud --> K8s
#  Data --> K8s
#  FinOps --> Execs

---

## 3) Multi-Cloud & Portability
**Current State:** mix of {{ cloud_provider | default("AWS primary") }} + SaaS dependencies.  
**Risks:** provider lock-in, fragmented IAM, single-region exposure.  

**Recommendations:**  
- Standardise Terraform backends (S3 + DynamoDB, Azure Storage + Cosmos, GCS + Firestore).  
- Adopt Crossplane or Cluster API for portability.  
- Abstract CI/CD with GitHub Actions reusable workflows.  

---

## 4) Security & Compliance
IAM policy-as-code example (Rego):

# package iam.rules
# deny[msg] {
#   input.role == "admin"
#   msg := "Admin roles are forbidden in production"
# }

**Secrets:** migrate to Vault/cloud-native managers.  
**Network:** zero-trust enforcement with private subnets + service mesh mTLS.  
**Compliance:** PCI, HIPAA, GDPR. IaC commits + CI logs = evidence.  

**Simulation Results:**  
- ❌ Ransomware: no immutable backups  
- ❌ Supply chain: no SBOM/signing  
- ⚠️ Insider threat: partial detection  
- ✅ DDoS: handled  
- ❌ Data exfil: no DLP  

---

## 5) Cost Optimisation
**Quick Wins:**  
- Replace static nodes → Karpenter  
- Spot + savings plans  
- Right-size pods  

**Hidden Cost Killers:**  
- Orphaned volumes: aws ec2 describe-volumes ...  
- Zombie LBs: kubectl get svc --all-namespaces | grep LoadBalancer  
- Untagged resources: aws ce get-cost-and-usage ...  

**Quick Win Calculator:**  
# kubectl top nodes --all-namespaces | awk '{sum+=$3} END {print "Waste = " sum*0.7}'

---

## 6) Resilience & DR
- Multi-AZ, cross-region replication  
- DR drills with RPO ≤ 15m, RTO ≤ 1h  
- Chaos experiments (Litmus, Gremlin)  

**Terraform Pattern:** paired clusters across 2 regions + Route53 failover  

---

## 7) Observability
- Metrics: Prometheus + Thanos  
- Logs: Loki/ELK with PII redaction  
- Tracing: OpenTelemetry + Jaeger  
- SLOs: success rate >99.9%, burn rate alerts  

---

## 8) Automation & Runbooks
- Standard Terraform modules  
- CI/CD with approval gates  
- Incident runbooks (top 10)  
- Self-service via Atlantis  

---

## 9) AI/ML Platform Readiness
**Current:** ad-hoc notebooks  
**Target:** governed production ML  

Quick start: Kubeflow/MLflow, GPU node pools, Feast feature store, LLM cost tracking  

---

## 10) Team Velocity Metrics
| Team     | Deploys/Week | MTTR | Fail % | Lead Time |
|----------|--------------|------|--------|-----------|
| Platform | 47           | 12m  | 2%     | 2h        |
| Product  | 8            | 4h   | 18%    | 3d        |
| Data     | 3            | 2d   | 35%    | 2w        |

---

## 11) Industry Benchmark
| Metric            | You   | Top 10% | Gap  | Impact        |
|-------------------|-------|---------|------|---------------|
| Deploy frequency  | 8/wk  | 100/d   | -95% | Slow delivery |
| MTTR              | 4h    | 10m     | -24x | Higher churn  |
| Cloud efficiency  | 42%   | 75%     | -33% | $2M waste/yr  |
| Security score    | 61/100| 95/100  | -34  | Breach risk   |

---

## 12) Risks & Trade-offs
- CNCF over-engineering → ops fatigue (mitigate: 6 core tools only)  
- IAM sprawl → breach risk (mitigate: policy-as-code)  
- Cost growth → CFO pushback (mitigate: FinOps guardrails)  
- Compliance gaps → fines (mitigate: evidence automation)  

---

## 13) Compliance & Governance
- IaC evidence for auditors  
- Enforce data residency via tags  
- Redact PII before SIEM ingestion  

---

## 14) Quick Wins
- Enable audit logging  
- Add PodDisruptionBudgets  
- Integrate Trivy/Grype scans  
- RBAC sync with HR system  

---

## 15) Roadmap
- **0–3m:** IAM hardening, secrets migration, FinOps uplift  
- **3–6m:** DR readiness, Terraform standardisation  
- **6–12m:** Multi-cloud, self-service, chaos engineering  

---

## 16) ROI Snapshot
| Initiative             | Investment | ROI                  |
|------------------------|------------|----------------------|
| FinOps guardrails      | 2w         | $1M/yr saved         |
| Compliance automation  | 1 sprint   | -40% audit effort    |
| DR readiness           | 1m         | Avoid $200k/hr loss  |
| Developer self-service | 2m         | +25% faster delivery |
| Security uplift        | 3m         | -70% breach risk     |

---

✅ End of Template